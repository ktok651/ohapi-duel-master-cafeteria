<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>予定表</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Hiragino Sans', sans-serif;
    }

    body {
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    .schedule-panel,
    .calendar-panel {
      padding: 24px;
      background: #fff;
    }

    .schedule-panel {
      flex: 1;
      border-right: 1px solid #eee;
    }

    .calendar-panel {
      width: 420px;
    }

    .calendar-actions {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .calendar-actions button {
      align-self: flex-start;
      border: none;
      background: #2563eb;
      color: #fff;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }

.password-panel,
.music-panel {
  padding: 10px;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  background: #f9fafb;
}

.music-panel {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.music-panel button {
  align-self: flex-start;
  border: none;
  background: #8b5cf6;
  color: #fff;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}

    .password-panel input {
      margin-top: 6px;
      padding: 6px;
      width: 180px;
    }

    .password-panel button {
      margin-left: 8px;
    }

    .status-text {
      font-weight: 600;
      color: #065f46;
    }

    .edit-panel {
      margin-top: 16px;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f3f4f6;
    }

    .edit-panel textarea {
      width: 100%;
      min-height: 80px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      resize: vertical;
    }

    .edit-panel button {
      margin-top: 8px;
      border: none;
      background: #16a34a;
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .custom-schedule-display {
      margin-top: 12px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    td.custom-scheduled {
      background: #111827;
      color: #f9fafb;
    }

    td.custom-scheduled .day-number {
      color: inherit;
    }

    td.custom-scheduled.has-event::after {
      background: #fbbf24;
    }

    .note {
      margin: 6px 0 0;
      color: #4b5563;
      font-size: 0.9rem;
    }

    .hidden {
      display: none;
    }

    h1 {
      margin: 0 0 16px;
    }

    .selected-date {
      font-size: 1.1rem;
      margin: 0 0 8px;
      color: #374151;
      font-weight: 600;
    }

    .duty-summary {
      margin-top: 16px;
      padding: 16px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
    }

    .duty-label {
      margin: 0 0 8px;
      font-weight: 600;
      color: #4b5563;
    }

    .duty-value {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 700;
      color: #111827;
    }

    .schedule-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .schedule-list li {
      padding: 12px;
      margin-bottom: 8px;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      background: #fafafa;
    }

    .schedule-list li strong {
      display: block;
      font-size: 1.05rem;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .calendar-header button {
      border: none;
      background: #4f46e5;
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .calendar-header button[disabled] {
      opacity: 0.5;
      cursor: default;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid #e5e7eb;
    }

    th {
      text-align: center;
      padding: 8px 0;
      color: #6b7280;
      font-weight: 600;
      border: 1px solid #e5e7eb;
    }

    td {
      text-align: center;
      padding: 12px 0 30px;
      cursor: pointer;
      position: relative;
      border: 1px solid #e5e7eb;
    }

    td:hover {
      background: #eef2ff;
    }

    td.disabled {
      color: #ccc;
      cursor: default;
    }

    td.selected .day-number {
      background: #4f46e5;
      color: #fff;
    }

    td.today {
      border: 3px solid #ef4444;
    }

    td.has-event::after {
      content: '';
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #4f46e5;
    }

    .day-number {
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
    }

    .band {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 4px;
      height: 16px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: #1f2937;
      pointer-events: none;
    }

    .band-start {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-top-left-radius: 999px;
      border-bottom-left-radius: 999px;
    }

    .band-middle {
      border-radius: 0;
    }

    .band-end {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      border-top-right-radius: 999px;
      border-bottom-right-radius: 999px;
    }

    .band-single {
      border-radius: 999px;
    }

    @media (max-width: 900px) {
      .app {
        flex-direction: column;
      }

      .calendar-panel {
        width: auto;
        border-top: 1px solid #eee;
      }

      .schedule-panel {
        border-right: none;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <section class="schedule-panel">
      <h1 id="pageTitle">本日の日付</h1>
      <ul class="schedule-list" id="scheduleList"></ul>
      <div class="duty-summary">
        <p class="selected-date" id="selectedDate"></p>
        <p class="duty-value" id="dutyValue">小原の勤務予定：-</p>
      </div>
      <div class="custom-schedule-display" id="customScheduleDisplay">-</div>
      <div class="edit-panel hidden" id="scheduleEditPanel">
        <p id="editPanelTitle"></p>
        <textarea id="scheduleInput" maxlength="200" placeholder="200文字以内で予定を入力してください"></textarea>
        <button id="saveSchedule">保存</button>
        <p class="note" id="editPanelNote"></p>
      </div>
    </section>
    <section class="calendar-panel">
      <div class="calendar-header">
        <button id="prevMonth">◀</button>
        <div id="calendarTitle"></div>
        <button id="nextMonth">▶</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>日</th>
            <th>月</th>
            <th>火</th>
            <th>水</th>
            <th>木</th>
            <th>金</th>
            <th>土</th>
          </tr>
        </thead>
        <tbody id="calendarBody"></tbody>
      </table>
      <div class="calendar-actions">
        <button id="editModeButton">編集モード</button>
        <div class="password-panel hidden" id="passwordPanel">
          <div>パスワードを入力してください</div>
          <input type="password" id="passwordInput" placeholder="******" />
          <button id="passwordSubmit">送信</button>
          <div class="note" id="passwordMessage"></div>
        </div>
        <div class="status-text hidden" id="editStatus">編集モード中</div>
        <button class="hidden" id="exitEditButton">通常モードに戻る</button>
        <button class="hidden" id="musicButton">音楽の設定</button>
        <div class="music-panel hidden" id="musicPanel">
          <div>流したい曲のファイルを選択してください</div>
          <input type="file" id="musicInput" accept="audio/mpeg,audio/wav,audio/ogg,audio/mp4,audio/x-m4a" />
          <button id="musicSave">音楽を保存</button>
          <div class="note">アップロード可能: MP3, WAV, OGG, M4A 形式</div>
          <div class="note" id="musicMessage"></div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const scheduleData = {
      '2024-06-05': [
        { title: '企画ミーティング', time: '10:00-11:00' },
        { title: 'ランチ @社外', time: '12:30-13:30' }
      ],
      '2024-06-10': [
        { title: 'クライアント訪問', time: '14:00-15:30' }
      ],
      '2024-06-21': [
        { title: '社内勉強会', time: '16:00-17:30' }
      ]
    };

    const bandColors = {
      A: 'rgba(239, 68, 68, 0.35)',
      B: 'rgba(59, 130, 246, 0.35)',
      C: 'rgba(250, 204, 21, 0.35)',
      '休': 'rgba(34, 197, 94, 0.35)'
    };

    const bandCycle = [
      { label: 'A', days: 4 },
      { label: '休', days: 1 },
      { label: 'C', days: 4 },
      { label: '休', days: 2 },
      { label: 'B', days: 4 },
      { label: '休', days: 1 }
    ];

    const cycleStartDate = new Date('2025-11-09T00:00:00');
    const cycleLength = bandCycle.reduce((sum, block) => sum + block.days, 0);

    const pageTitle = document.getElementById('pageTitle');
    const calendarTitle = document.getElementById('calendarTitle');
    const calendarBody = document.getElementById('calendarBody');
    const selectedDateLabel = document.getElementById('selectedDate');
    const scheduleList = document.getElementById('scheduleList');
    const dutyValue = document.getElementById('dutyValue');
    const customScheduleDisplay = document.getElementById('customScheduleDisplay');
    const scheduleEditPanel = document.getElementById('scheduleEditPanel');
    const editPanelTitle = document.getElementById('editPanelTitle');
    const scheduleInput = document.getElementById('scheduleInput');
    const saveScheduleButton = document.getElementById('saveSchedule');
    const editPanelNote = document.getElementById('editPanelNote');
    const editModeButton = document.getElementById('editModeButton');
    const passwordPanel = document.getElementById('passwordPanel');
    const passwordInput = document.getElementById('passwordInput');
    const passwordSubmit = document.getElementById('passwordSubmit');
    const passwordMessage = document.getElementById('passwordMessage');
    const editStatus = document.getElementById('editStatus');
    const exitEditButton = document.getElementById('exitEditButton');
    const musicButton = document.getElementById('musicButton');
    const musicPanel = document.getElementById('musicPanel');
    const musicInput = document.getElementById('musicInput');
    const musicMessage = document.getElementById('musicMessage');
    const musicSaveButton = document.getElementById('musicSave');

    const today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let selectedDate = new Date(today);
    let isEditMode = false;
    const customSchedules = {};
    let audioPlayer = null;
    let audioObjectUrl = '';
    let selectedMusicFile = null;
    let musicDb = null;

    function formatDate(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function formatMonthDay(date) {
      return `${date.getMonth() + 1}月${date.getDate()}日`;
    }

    function formatDisplayDate(date) {
      return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日(${['日','月','火','水','木','金','土'][date.getDay()]})`;
    }

    function renderSchedule(dateStr) {
      const schedules = scheduleData[dateStr] || [];
      scheduleList.innerHTML = '';
      schedules.forEach(({ title, time }) => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${title}</strong><span>${time}</span>`;
        scheduleList.appendChild(li);
      });
    }

    function updateDutySummary(date) {
      const info = getBandInfo(date);
      dutyValue.textContent = info
        ? `小原の勤務予定：${info.label}${info.label === '休' ? '' : '勤務'} ${info.day}日目`
        : '小原の勤務予定：―';
    }

    function updateCustomScheduleDisplay(date) {
      const key = formatDate(date);
      const text = (customSchedules[key] || '').trim();
      customScheduleDisplay.textContent = `${formatMonthDay(date)}の予定：${text || 'なし'}`;
    }

    function updateEditPanel(date) {
      if (!isEditMode) {
        scheduleEditPanel.classList.add('hidden');
        return;
      }
      const key = formatDate(date);
      scheduleEditPanel.classList.remove('hidden');
      editPanelTitle.textContent = `${formatMonthDay(date)}の予定の追加`;
      scheduleInput.value = customSchedules[key] || '';
      updateEditPanelNote();
    }

    function updateEditPanelNote(message = '') {
      const remaining = 200 - scheduleInput.value.length;
      const base = `残り${remaining}文字`;
      editPanelNote.textContent = message ? `${message} / ${base}` : base;
    }

    function getMusicDb() {
      if (!('indexedDB' in window)) {
        return Promise.reject(new Error('IndexedDB not supported'));
      }
      if (musicDb) return Promise.resolve(musicDb);
      return new Promise((resolve, reject) => {
        const request = indexedDB.open('yoteiMusic', 1);
        request.onupgradeneeded = () => {
          const db = request.result;
          if (!db.objectStoreNames.contains('files')) {
            db.createObjectStore('files');
          }
        };
        request.onsuccess = () => {
          musicDb = request.result;
          resolve(musicDb);
        };
        request.onerror = () => reject(request.error);
      });
    }

    function saveMusicToDb(file) {
      return getMusicDb().then(
        (db) =>
          new Promise((resolve, reject) => {
            const tx = db.transaction('files', 'readwrite');
            tx.oncomplete = () => resolve();
            tx.onerror = () => reject(tx.error);
            tx.objectStore('files').put({ id: 'current', name: file.name, type: file.type, blob: file });
          })
      );
    }

    function loadMusicFromDb() {
      return getMusicDb().then(
        (db) =>
          new Promise((resolve, reject) => {
            const tx = db.transaction('files', 'readonly');
            const req = tx.objectStore('files').get('current');
            req.onsuccess = () => resolve(req.result || null);
            req.onerror = () => reject(req.error);
          })
      );
    }

    function saveCustomSchedules() {
      try {
        localStorage.setItem('customSchedules', JSON.stringify(customSchedules));
      } catch (e) {
        // 保存失敗時は黙って無視
      }
    }

    function loadCustomSchedules() {
      const stored = localStorage.getItem('customSchedules');
      if (!stored) return;
      try {
        const parsed = JSON.parse(stored);
        Object.keys(parsed).forEach((key) => {
          customSchedules[key] = parsed[key];
        });
      } catch (e) {
        // 壊れたデータは無視
      }
    }

    function getBandInfo(date) {
      const diffDays = Math.floor((date - cycleStartDate) / (1000 * 60 * 60 * 24));
      let offset = diffDays % cycleLength;
      if (offset < 0) offset += cycleLength;

      let accumulated = 0;
      for (const block of bandCycle) {
        const spanStart = accumulated;
        const spanEnd = accumulated + block.days - 1;
        if (offset >= spanStart && offset <= spanEnd) {
          const position =
            block.days === 1
              ? 'single'
              : offset === spanStart
              ? 'start'
              : offset === spanEnd
              ? 'end'
              : 'middle';
          return {
            label: block.label,
            color: bandColors[block.label],
            position,
            day: offset - spanStart + 1
          };
        }
        accumulated += block.days;
      }
      return null;
    }

    function renderCalendar(year, month) {
      calendarBody.innerHTML = '';
      calendarTitle.textContent = `${year}年 ${month + 1}月`;

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      let date = 1;
      for (let row = 0; row < 6; row++) {
        const tr = document.createElement('tr');
        for (let col = 0; col < 7; col++) {
          const td = document.createElement('td');
          if (row === 0 && col < firstDay) {
            td.classList.add('disabled');
            tr.appendChild(td);
            continue;
          }

          if (date > daysInMonth) {
            td.classList.add('disabled');
            tr.appendChild(td);
            continue;
          }

          const cellDate = new Date(year, month, date);
          const cellDateStr = formatDate(cellDate);
          const isToday = cellDateStr === formatDate(today);
          const dayNumber = document.createElement('div');
          dayNumber.className = 'day-number';
          dayNumber.textContent = date;
          td.appendChild(dayNumber);

          const bandInfo = getBandInfo(cellDate);
          if (bandInfo) {
            const band = document.createElement('div');
            band.className = `band band-${bandInfo.position}`;
            band.textContent = bandInfo.label;
            band.style.backgroundColor = bandInfo.color;
            td.appendChild(band);
          }

          if (scheduleData[cellDateStr]) {
            td.classList.add('has-event');
          }

          if (customSchedules[cellDateStr] && customSchedules[cellDateStr].trim()) {
            td.classList.add('custom-scheduled');
          }

          if (isToday) {
            td.classList.add('today');
          }

          if (cellDateStr === formatDate(selectedDate)) {
            td.classList.add('selected');
          }

          td.addEventListener('click', () => {
            selectedDate = cellDate;
            selectedDateLabel.textContent = formatDisplayDate(cellDate);
            renderSchedule(cellDateStr);
            updateDutySummary(cellDate);
            updateCustomScheduleDisplay(cellDate);
            updateEditPanel(cellDate);
            renderCalendar(currentYear, currentMonth);
          });

          tr.appendChild(td);
          date++;
        }
        calendarBody.appendChild(tr);
      }
    }

    document.getElementById('prevMonth').addEventListener('click', () => {
      if (currentMonth === 0) {
        currentYear--;
        currentMonth = 11;
      } else {
        currentMonth--;
      }
      renderCalendar(currentYear, currentMonth);
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      if (currentMonth === 11) {
        currentYear++;
        currentMonth = 0;
      } else {
        currentMonth++;
      }
      renderCalendar(currentYear, currentMonth);
    });

    function playAudioSource(src, name, isObjectUrl = false) {
      if (audioObjectUrl && audioObjectUrl !== src) {
        URL.revokeObjectURL(audioObjectUrl);
        audioObjectUrl = '';
      }
      if (isObjectUrl) {
        audioObjectUrl = src;
      }
      if (!audioPlayer) {
        audioPlayer = new Audio();
        audioPlayer.loop = true;
      }
      audioPlayer.src = src;
      audioPlayer.play().then(() => {
        musicMessage.textContent = `再生中: ${name}`;
      }).catch(() => {
        musicMessage.textContent = `保存済みの曲: ${name}（再生がブロックされています。音楽の設定を開いて再生してください）`;
      });
    }

    async function loadSavedMusic() {
      // IndexedDB 優先
      try {
        const saved = await loadMusicFromDb();
        if (saved && saved.blob) {
          const src = URL.createObjectURL(saved.blob);
          playAudioSource(src, saved.name || '保存された曲', true);
          musicMessage.textContent = `保存済みの曲: ${saved.name || '保存された曲'}`;
          return;
        }
      } catch (e) {
        // DB取得に失敗した場合はローカルストレージへフォールバック
      }

      const savedLocal = localStorage.getItem('savedMusic');
      if (savedLocal) {
        try {
          const parsed = JSON.parse(savedLocal);
          if (parsed.dataUrl && parsed.name) {
            playAudioSource(parsed.dataUrl, parsed.name, false);
            musicMessage.textContent = `保存済みの曲: ${parsed.name}`;
          }
        } catch (e) {
          // 保存データが壊れている場合は無視
        }
      }
    }

    editModeButton.addEventListener('click', () => {
      passwordPanel.classList.remove('hidden');
      passwordMessage.textContent = '';
      passwordInput.value = '';
      passwordInput.focus();
    });

    passwordSubmit.addEventListener('click', () => {
      if (passwordInput.value === '214171') {
        isEditMode = true;
        passwordPanel.classList.add('hidden');
        passwordMessage.textContent = '';
        editStatus.classList.remove('hidden');
        editModeButton.textContent = '編集モード中';
        editModeButton.disabled = true;
        exitEditButton.classList.remove('hidden');
        musicButton.classList.remove('hidden');
        updateEditPanel(selectedDate);
      } else {
        passwordMessage.textContent = 'パスワードが違います';
      }
    });

    musicButton.addEventListener('click', () => {
      musicPanel.classList.toggle('hidden');
      musicMessage.textContent = '';
    });

    exitEditButton.addEventListener('click', () => {
      isEditMode = false;
      scheduleEditPanel.classList.add('hidden');
      editStatus.classList.add('hidden');
      exitEditButton.classList.add('hidden');
      editModeButton.textContent = '編集モード';
      editModeButton.disabled = false;
      passwordPanel.classList.add('hidden');
      musicPanel.classList.add('hidden');
      musicButton.classList.add('hidden');
    });

    musicInput.addEventListener('change', () => {
      const file = musicInput.files[0];
      if (!file) return;
      const mimeOk = ['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/mp4', 'audio/x-m4a'].includes(file.type);
      const extOk = file.name.toLowerCase().endsWith('.m4a');
      if (!mimeOk && !extOk) {
        musicMessage.textContent = '対応形式ではありません（MP3 / WAV / OGG / M4A）';
        return;
      }
      selectedMusicFile = file;
      const objectUrl = URL.createObjectURL(file);
      playAudioSource(objectUrl, file.name, true);
      musicMessage.textContent += '（保存するには「音楽を保存」を押してください）';
    });

    musicSaveButton.addEventListener('click', async () => {
      if (!selectedMusicFile) {
        musicMessage.textContent = '先に音楽ファイルを選択してください。';
        return;
      }
      const file = selectedMusicFile;
      let savedInDb = false;
      let dbError = null;
      try {
        await saveMusicToDb(file);
        localStorage.setItem('savedMusicMeta', JSON.stringify({ name: file.name }));
        const objectUrl = URL.createObjectURL(file);
        playAudioSource(objectUrl, file.name, true);
        musicMessage.textContent = `保存しました: ${file.name}`;
        savedInDb = true;
      } catch (e) {
        dbError = e;
        musicMessage.textContent = 'IndexedDBへの保存に失敗しました。ローカルストレージへ保存を試みます。';
      }

      // フォールバック: 旧バージョンのデータ形式も保持
      const reader = new FileReader();
      reader.onload = () => {
        try {
          localStorage.setItem('savedMusic', JSON.stringify({ name: file.name, dataUrl: reader.result }));
          localStorage.setItem('savedMusicMeta', JSON.stringify({ name: file.name }));
          if (!savedInDb) {
            playAudioSource(reader.result, file.name, false);
            musicMessage.textContent = `ローカルストレージに保存しました: ${file.name}`;
          }
        } catch (e) {
          musicMessage.textContent =
            '音楽を保存できませんでした。プライベートブラウズを解除するか、ストレージ空き容量を確認してください。';
          if (dbError) {
            musicMessage.textContent += '（IndexedDB/LocalStorage両方で失敗）';
          }
        }
      };
      reader.onerror = () => {
        musicMessage.textContent = 'ファイルの読み込みに失敗しました。';
      };
      reader.readAsDataURL(file);
    });

    scheduleInput.addEventListener('input', () => updateEditPanelNote());

    saveScheduleButton.addEventListener('click', () => {
      if (!isEditMode) return;
      const key = formatDate(selectedDate);
      const value = scheduleInput.value.trim();
      if (value) {
        customSchedules[key] = value;
      } else {
        delete customSchedules[key];
      }
      saveCustomSchedules();
      updateCustomScheduleDisplay(selectedDate);
      updateEditPanelNote('保存しました');
      renderCalendar(currentYear, currentMonth);
    });

    async function init() {
      pageTitle.textContent = `本日の日付 - ${formatDisplayDate(today)}`;
      selectedDateLabel.textContent = formatDisplayDate(selectedDate);
      renderSchedule(formatDate(selectedDate));
      loadCustomSchedules();
      renderCalendar(currentYear, currentMonth);
      updateDutySummary(selectedDate);
      updateCustomScheduleDisplay(selectedDate);
      await loadSavedMusic();
      const savedMeta = localStorage.getItem('savedMusicMeta');
      if (savedMeta) {
        try {
          const parsed = JSON.parse(savedMeta);
          if (parsed.name) {
            musicMessage.textContent = `保存済みの曲: ${parsed.name}`;
          }
        } catch (e) {
          // ignore meta parse error
        }
      }
    }

    init();
  </script>
</body>
</html>
